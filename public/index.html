<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Финансы</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        body { font-family: sans-serif; background: var(--tg-theme-bg-color, #fff); color: var(--tg-theme-text-color, #000); padding: 20px; }
        .balance { font-size: 32px; font-weight: bold; text-align: center; margin-bottom: 20px; }
        input, button { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; }
        button { background: var(--tg-theme-button-color, #3390ec); color: white; border: none; font-weight: bold; cursor: pointer; }
        .item { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
        .red { color: red; } .green { color: green; }
    </style>
</head>
<body>

    <div class="balance" id="balance">0 ₽</div>

    <input type="number" id="sum" placeholder="Сумма (150)">
    <input type="text" id="cat" placeholder="На что? (Продукты)">
    <button onclick="add()">Добавить расход</button>

    <div id="history">Загрузка...</div>

    <script>
        // ТВОИ ДАННЫЕ С КАРТИНКИ
        const firebaseConfig = {
            apiKey: "AIzaSyB0FqDYXnDGRnXVXjkikbaNNePDvgDXAWc",
            authDomain: "burzhuy-pro-v2.firebaseapp.com",
            projectId: "burzhuy-pro-v2",
            storageBucket: "burzhuy-pro-v2.firebasestorage.app",
            messagingSenderId: "627105413900",
            appId: "1:627105413900:web:3e4d8563e50a542f256729",
            measurementId: "G-YWYR0HFXE4"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const tg = window.Telegram.WebApp;
        tg.expand();

        // ID юзера
        const userId = tg.initDataUnsafe?.user?.id ? String(tg.initDataUnsafe.user.id) : "test_user_pc";

        function render() {
            db.collection('users').doc(userId).collection('transactions')
              .orderBy('date', 'desc').limit(20)
              .onSnapshot(snap => {
                let total = 0;
                let html = '';
                snap.forEach(doc => {
                    const d = doc.data();
                    total += d.amount;
                    html += `<div class="item"><span>${d.cat}</span><b class="${d.amount < 0 ? 'red' : 'green'}">${d.amount}</b></div>`;
                });
                document.getElementById('balance').innerText = total + ' ₽';
                document.getElementById('history').innerHTML = html || 'Пусто';
            });
        }

        function add() {
            const sum = parseFloat(document.getElementById('sum').value);
            const cat = document.getElementById('cat').value || 'Прочее';
            if(!sum) return;

            db.collection('users').doc(userId).collection('transactions').add({
                amount: -Math.abs(sum), // Минус, так как расход
                cat: cat,
                date: firebase.firestore.FieldValue.serverTimestamp()
            });
            document.getElementById('sum').value = '';
            document.getElementById('cat').value = '';
        }

        render();
    </script>
</body>
</html>
